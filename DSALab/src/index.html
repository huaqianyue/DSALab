<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>DSALab</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <!-- <link rel="stylesheet" href="style.css">  -->
    <style>
      /* 欢迎模态框样式 */
      .welcome-modal {
        max-width: 800px;
        max-height: 80vh;
        overflow-y: auto;
      }
      
      .welcome-section {
        margin-bottom: 20px;
        padding: 15px;
        background: #f9f9f9;
        border-radius: 8px;
        border-left: 4px solid #1890ff;
      }
      
      .welcome-section h3 {
        margin: 0 0 10px 0;
        color: #1890ff;
        display: flex;
        align-items: center;
        gap: 10px;
      }
      
      .welcome-section p {
        margin: 0;
        line-height: 1.6;
        color: #666;
      }
      
      .welcome-section i {
        font-size: 1.2em;
        width: 24px;
      }
      
      .modal-footer label {
        display: flex;
        align-items: center;
        gap: 8px;
        font-size: 14px;
        color: #666;
      }
    </style>
  </head>
  <body>
    <div id="app">
      <!-- 全局顶部导航栏 (Global Header Bar) -->
      <header class="global-header-bar">
        <div class="header-left">
          <!-- 新增：刷新、导入、保存按钮 -->
          <button id="refreshBtn" class="action-button" data-tooltip="刷新题目列表">
            <i class="fas fa-sync-alt"></i> 刷新
          </button>
          <button id="importBtn" class="action-button" data-tooltip="导入题目列表">
            <i class="fas fa-file-import"></i> 导入
          </button>
          <button id="saveBtn" class="action-button" data-tooltip="保存当前题目 (Ctrl+S)">
            <i class="fas fa-save"></i> 保存
          </button>
          <!-- 导出按钮 (移动到保存按钮之后) -->
          <button id="exportBtn" class="action-button" data-tooltip="导出">
            <i class="fas fa-download"></i> 导出
          </button>
        </div>
        <div class="header-center">
          <!-- 运行按钮已移动到代码编辑器面板头部 -->
        </div>
        <div class="header-right">
          <!-- 修改：学生信息改为可编辑输入框，横向排列，并移动到右侧 -->
          <div class="user-info">
            <input type="text" id="userNameInput" class="userNameInput" placeholder="输入姓名" data-tooltip="姓名">
            <input type="text" id="studentIdInput" class="studentIdInput" placeholder="输入学号" data-tooltip="学号">
          </div>
          <!-- 新增：帮助按钮 -->
          <button id="helpBtn" class="action-button" data-tooltip="查看使用帮助" onclick="showWelcomeModal()">
            <i class="fas fa-question-circle"></i> 帮助
          </button>
        </div>
      </header>

      <!-- 主要工作区 (Workspace) - 左右分割 -->
      <div class="workspace">
        <!-- 左侧面板：题目描述 (Problem Description Panel) -->
        <div class="problem-description-panel">
          <!-- 新增：题目列表和题目描述的标签页头部 -->
          <div class="problem-panel-tabs">
            <div class="problem-tab-header active" data-tab-target="problem-list" id="problemListTabHeader">
              <i class="fas fa-list-ul"></i> 题目列表
            </div>
            <div class="problem-tab-header" data-tab-target="problem-description" id="problemDescriptionTabHeader">
              <i class="fas fa-book"></i> 题目描述
            </div>
          </div>

          <!-- 新增：题目列表内容区域 -->
          <div class="problem-list-content panel-content active" data-tab-id="problem-list">
            <ul class="problem-list">
              <!-- 题目列表将由JS动态加载 -->
            </ul>
          </div>

          <!-- 题目描述的具体内容，现在是第二个标签页的内容 -->
          <div class="problem-description-content panel-content" data-tab-id="problem-description" id="problemDescriptionContent">
            <p>请从左侧的“题目列表”中选择一个题目查看其描述。</p>
            <!-- 导航按钮将由JS动态插入到此处 -->
          </div>

          <!-- 移除这个分割线，因为音频面板将有固定高度 -->
          <!-- <div class="horizontal-split-divider"></div> --> 
          
          <!-- 新增：音频录制与播放面板 -->
          <div class="audio-panel hidden"> <!-- 默认隐藏 -->
            <div class="panel-header">
              <div class="panel-title">
                <i class="fas fa-microphone-alt"></i> 音频讲解
              </div>
            </div>
            <div class="panel-content audio-controls">
              <button id="recordAudioBtn" class="btn-audio" data-tooltip="录制音频">
                <i class="fas fa-microphone"></i> 录制
              </button>
              <button id="pauseResumeBtn" class="btn-audio" data-tooltip="暂停/继续" disabled>
                <i class="fas fa-pause"></i> 暂停
              </button>
              <audio id="audioPlayback" controls style="display: none;"></audio>
            </div>
          </div>
        </div>

        <!-- 主分割线 (Main Split Divider) -->
        <div class="main-split-divider"></div>

        <!-- 右侧面板：代码编辑器 & 运行结果 (Code Editor & Test Cases Panel) -->
        <div class="code-test-panel">
          <!-- 右侧面板顶部操作栏 -->
          <div class="panel-header">
            <div class="panel-title">
              <i class="fas fa-code"></i> 代码
            </div>
            <div class="panel-actions">
              <!-- 修改：运行按钮移动到此处，并删除语言选择和默认模式 -->
               
              <button id="runBtn" class="action-button run-btn" data-tooltip="运行 (Ctrl+R)">
                <i class="fas fa-play"></i> 运行
              </button>
            </div>
          </div>

          <!-- 代码编辑器区域 -->
          <div class="editor-container">
            <!-- Monaco Editor 或其他编辑器会在此处初始化 -->
          </div>

          <!-- 右侧面板内部水平分割线 -->
          <div class="horizontal-split-divider"></div>

          <!-- 运行结果区域 -->
          <div class="test-output-area">
            <div class="panel-header">
              <!-- 修改：统一风格，添加图标和标题文字 -->
              <div class="panel-title">
                <i class="fas fa-terminal"></i> 终端
              </div>
              <button id="clearOutputBtn" class="action-button" data-tooltip="清空输出">
                <i class="fas fa-trash"></i> 清除
              </button>
            </div>
            <div class="panel-content">
              <!-- 修改：删除测试用例输入区域 -->
              <!-- 输出结果区域 -->
              <div class="output-container">
              </div>
              <!-- 新增：终端输入区域 -->
              <div class="terminal-input-area">
                <span class="prompt">$&gt;</span>
                <input type="text" id="terminalInput" class="terminal-input" placeholder="输入..." disabled>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- 导出题目弹窗 -->
    <div id="exportModal" class="modal hidden">
      <div class="modal-content">
        <div class="modal-header">
          <h2>导出题目</h2>
          <span class="close-button">&times;</span>
        </div>
        <div class="modal-body">
          <p>请选择要导出的题目：</p>
          <div class="export-problem-list-container">
            <ul id="exportProblemList" class="problem-list">
              <!-- 导出题目列表将由JS动态加载 -->
            </ul>
          </div>
        </div>
        <div class="modal-footer">
          <button id="cancelExportBtn" class="btn-audio">取消</button>
          <button id="confirmExportBtn" class="btn-audio">导出</button>
        </div>
      </div>
    </div>

    <!-- 欢迎引导模态框 -->
    <div id="welcomeModal" class="modal hidden">
      <div class="modal-content welcome-modal">
        <div class="modal-header">
          <h2>🎉 欢迎使用 DSALab!</h2>
          <span class="close-button" onclick="closeWelcomeModal()">&times;</span>
        </div>
        <div class="modal-body">
          <div class="welcome-section">
            <h3><i class="fas fa-cog"></i> 环境配置要求</h3>
            <p>请先安装MinGW-w64，并设置好环境变量，参考 
              <a href="https://zhuanlan.zhihu.com/p/26143367916" target="_blank" style="color: #1890ff; text-decoration: underline;">
                MinGW-w64安装教程
              </a>
            </p>
          </div>

          <div class="welcome-section">
            <h3><i class="fas fa-sync-alt"></i> 刷新与导入功能</h3>
            <p>打开DSALab时，会自动从GitHub获取最新题目并合并到本地。如果云端获取失败，会显示本地已有题目。您也可以通过"导入"按钮从本地JSON文件导入题目。</p>
          </div>

          <div class="welcome-section">
            <h3><i class="fas fa-list-ul"></i> 题目列表</h3>
            <p>完成题目的代码和音频讲解后，相应的图标会点亮，方便您跟踪完成进度。</p>
          </div>

          <div class="welcome-section">
            <h3><i class="fas fa-book"></i> 题目描述</h3>
            <p>点击具体题目可以查看详细的题目要求和描述说明。</p>
          </div>

          <div class="welcome-section">
            <h3><i class="fas fa-microphone"></i> 音频录制</h3>
            <p>使用音频功能录制题目讲解，分享您的解题思路和方法。</p>
          </div>

          <div class="welcome-section">
            <h3><i class="fas fa-code"></i> 代码编写</h3>
            <p>在代码编辑器中编写C++解决方案，支持语法高亮和智能提示。</p>
          </div>

          <div class="welcome-section">
            <h3><i class="fas fa-terminal"></i> 终端</h3>
            <p>显示控制信息、编译运行结果，输入栏可与运行中的程序进行交互。</p>
          </div>

          <div class="welcome-section">
            <h3><i class="fas fa-save"></i> 保存功能</h3>
            <p>切换题目时自动保存，也可点击保存按钮或使用快捷键Ctrl+S手动保存。</p>
          </div>

          <div class="welcome-section">
            <h3><i class="fas fa-user"></i> 用户信息</h3>
            <p>请在顶部填写学号和姓名，这些信息将用于导出文件的命名。</p>
          </div>

          <div class="welcome-section">
            <h3><i class="fas fa-download"></i> 导出功能</h3>
            <p>可导出已完成音频和代码的题目，导出为压缩包格式，文件名包含学号和姓名。</p>
          </div>
        </div>
        <div class="modal-footer">
          <label>
            <input type="checkbox" id="dontShowAgain"> <span id="welcomeToggleText">不再显示此提示</span>
          </label>
          <button class="btn-audio" onclick="closeWelcomeModal()">开始使用</button>
        </div>
      </div>
    </div>

    <script>
      // 欢迎模态框功能
      function showWelcomeModal() {
        const modal = document.getElementById('welcomeModal');
        modal.classList.remove('hidden');
        
        // 更新复选框状态和文本
        const dontShow = localStorage.getItem('welcomeModalDontShow');
        const checkbox = document.getElementById('dontShowAgain');
        const toggleText = document.getElementById('welcomeToggleText');
        
        if (dontShow === 'true') {
          // 当前设置为不显示提示，提供选项让用户选择显示提示
          toggleText.textContent = '显示此提示';
        } else {
          // 当前设置为显示提示，提供选项让用户选择不再显示提示
          toggleText.textContent = '不再显示此提示';
        }
      }

      function checkAndShowWelcomeModal() {
        const dontShow = localStorage.getItem('welcomeModalDontShow');
        if (!dontShow || dontShow === 'false') {
          setTimeout(showWelcomeModal, 1000);
        }
      }

      function closeWelcomeModal() {
        const modal = document.getElementById('welcomeModal');
        modal.classList.add('hidden');
        
        const checkbox = document.getElementById('dontShowAgain');
        const toggleText = document.getElementById('welcomeToggleText');
        const isChecked = checkbox.checked;
        const currentText = toggleText.textContent;
        
        // 根据复选框状态和文本内容设置localStorage
        if (isChecked) {
          if (currentText === '不再显示此提示') {
            // 用户勾选了"不再显示此提示"
            localStorage.setItem('welcomeModalDontShow', 'true');
          } else if (currentText === '显示此提示') {
            // 用户勾选了"显示此提示"
            localStorage.setItem('welcomeModalDontShow', 'false');
          }
        }
      }

      // 在默认浏览器中打开链接
      function openInDefaultBrowser(event) {
        event.preventDefault();
        const url = event.target.href;
        // 使用IPC调用主进程的shell.openExternal
        window.electron.openExternal(url);
      }

      // 为所有外部链接添加点击事件
      function setupExternalLinks() {
        const externalLinks = document.querySelectorAll('a[href^="http"]');
        externalLinks.forEach(link => {
          link.addEventListener('click', openInDefaultBrowser);
        });
      }

      // 页面加载完成后显示欢迎模态框并设置链接
      document.addEventListener('DOMContentLoaded', function() {
        checkAndShowWelcomeModal();
        setupExternalLinks();
      });
    </script>

    <script type="module" src="/src/renderer.ts"></script>
  </body>
</html>