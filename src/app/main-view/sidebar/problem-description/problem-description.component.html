<div class="problem-description-container">
  <!-- 题目描述内容 -->
  <div class="problem-description-content" *ngIf="currentProblem; else noProblemSelected">
    <!-- 题目标题 -->
    <div class="problem-header">
      <h3 class="problem-title">{{ currentProblem.Title }}</h3>
      <div class="navigation-buttons">
        <button 
          nz-button 
          nzType="text" 
          nzSize="small"
          [disabled]="!canNavigateToPrevious()"
          (click)="navigateToPrevious()"
          nz-tooltip 
          nzTooltipTitle="上一题">
          <i nz-icon nzType="left"></i>
        </button>
        <button 
          nz-button 
          nzType="text" 
          nzSize="small"
          [disabled]="!canNavigateToNext()"
          (click)="navigateToNext()"
          nz-tooltip 
          nzTooltipTitle="下一题">
          <i nz-icon nzType="right"></i>
        </button>
      </div>
    </div>

    <!-- 题目描述 -->
    <div class="problem-content">
      <div class="problem-description-panel">
        <div class="panel-header">
          <div class="panel-title">
            <i class="fas fa-file-alt"></i> 题目描述
          </div>
        </div>
        <div class="panel-content description-content">
          <div class="description-text" [innerHTML]="getFormattedDescription()"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- 未选择题目时的提示 -->
  <ng-template #noProblemSelected>
    <div class="no-problem-selected">
      <nz-empty 
        nzNotFoundImage="simple" 
        nzNotFoundContent="请从题目列表中选择一个题目">
      </nz-empty>
    </div>
  </ng-template>

  <!-- 音频录制面板 - 固定在底部 -->
  <div class="audio-panel" *ngIf="currentProblem">
    <div class="panel-header">
      <div class="panel-title">
        <i class="fas fa-microphone-alt"></i> 音频讲解
      </div>
    </div>
    <div class="panel-content audio-controls">
      <!-- 录制按钮 -->
      <button 
        class="btn-audio record-btn"
        [class.recording]="isRecording"
        [disabled]="!currentProblem"
        (click)="toggleRecordAudio()"
        [attr.data-tooltip]="getRecordButtonTooltip()">
        <i [class]="getRecordButtonIcon()"></i>
        <span>{{ getRecordButtonText() }}</span>
      </button>

      <!-- 暂停/继续按钮 -->
      <button 
        class="btn-audio pause-btn"
        [class.active]="isPaused"
        [disabled]="!isRecording"
        (click)="togglePauseResumeRecording()"
        [attr.data-tooltip]="isPaused ? '继续录制' : '暂停录制'">
        <i [class]="isPaused ? 'fas fa-play' : 'fas fa-pause'"></i>
        <span>{{ isPaused ? '继续' : '暂停' }}</span>
      </button>

      <!-- 录制时间显示 -->
      <div class="recording-time" *ngIf="isRecording || recordingTime > 0">
        <i class="fas fa-clock"></i>
        <span>{{ getFormattedRecordingTime() }}</span>
        <span class="recording-indicator" *ngIf="isRecording && !isPaused">●</span>
      </div>
    </div>

    <!-- Howler.js 音频播放器 -->
    <div class="howler-player-container" *ngIf="audioBlobUrl">
      <app-howler-audio-player
        [audioUrl]="audioBlobUrl"
        (durationLoaded)="onAudioDurationLoaded($event)"
        (playStateChange)="onAudioPlayStateChange($event)">
      </app-howler-audio-player>
    </div>
  </div>
</div>